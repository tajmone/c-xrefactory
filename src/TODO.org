# -*- org-todo-keyword-faces: (("DOING" . "orange")) -*-
#+TODO: TODO(t) DOING(i) | DONE(d)

There are a *lot* of things to do to make c-xref into modern C.

(This file is structured for Emacs org-mode...)

* DOING Remove bootstrap step (strfill and local definitions)
** DONE Remove the need for FILL_xxx macros
At this point there are 66, 65, 64, 63, 62, 41, 33, 15, 8 FILL-macros that are in use
*** DONE Remove position from proto.h
*** DONE Remove FILLF_typeModifier
*** DONE Remove chReference from proto.h
*** DONE Remove FILL_editor* from strFill
**** DONE Remove FILL_editorBuffer from strFill
***** DONE Move editorBuffer from proto.h to editor.h
*** DONE Remove FILL_chReference
*** DONE Remove cachePoint from proto.h
*** DONE Remove editorBuffer from proto.h
*** DONE Remove caching from proto.h
*** DONE Remove fileItem from proto.h
*** DONE Remove FILL_intlist
**** DONE Replace FILL_intList so we can remove strFill-dependency from classh.c
**** DONE Move intlist from proto.h to html.h
*** DONE Remove FILL_symbol()
***** DONE Remove #include "symbol" from proto.h
***** DONE semact.c requires FILL_symbolBits which are not strFill'ed
if symbol.h is not in proto.h. We need to create fillSymbolBits()
***** DONE Replace 0 with ACC_DEFAULT in calls to fillSymbolBits()
****** DONE symtab.h: unknown type name Symbol: include symbol instead of proto
******* DONE hashlist.th bool
***** DONE Replace all FILL_symbol() calls
***** DONE Move Symbol struct to Symbol-module
***** DONE Create a Symbol module with newSymbolxxx() & fillSymbolxxx()
The call pattern XX_ALLOC... FILL_symbolBits ... FILL_symbol is
prominent. And if we remove all instances where a newSymbol() function
returning a pointer would work that's a big step. Started on the
"remove-fill-symbol" branch. There is still an issue in that the
FILL_symbol macro takes one argument which is the name of the union
field that the next argument should assign to (is this a general
pattern for FILL-generation? Probably) Suggested solution is one
newSymbol<field>() for each of the necessary fields that are actually used.
*** DONE Remove FILL_symbollist() macro
** DONE Remove generation of str_fill from build
** TODO Remove code for generation of str_fill
* DOING Handle struct literals ("(type){.field = data, ...}")
** DONE Create test case
** DOING Create AST using parsing
* DOING Re-work standard options, since reading included files may
depend on them. Think about calling compiler to get defines, much
like generation of "compiler_defines.g.h" was done. It should be
possible to piggyback on the command line options handling. That
is performed by the last lines in addMacroDefinedByOption()
* TODO Refactor int2StringTabs, should not have Init in them
* TODO Rename classh to hierarchy
* TODO Initialize memory's injected error functions in main.c
* TODO Cleanup and separate commons, misc and make them independent utility modules
* TODO Investigate to remove S_classTreeData
* TODO Check if the C-part of Yacc grammar is identical, and if so extract it
* TODO Use Yacc's -p for "symbol_prefix" instead of the #defines?
* TODO Fix the move_class test
* TODO Use enum types wherever possible Storage, SymbolType, ...
* TODO Rename some of the options, like -no_str -> -no-structs
* TODO Why does -refactory read the users default .c-xrefrc?
* TODO Rename res fields in completion structs
* TODO Change all "-no_" options to modern "-no-"
* TODO Cannot mock structs as arguments like in symbol.mock
We need to change pos to *pos if that's gonna work
* TODO Rename reftab.[ch] to cxreftab.[ch]? Or s_cxreftab to s_reftab?
* TODO Clean up documentation, primarily remove 'create_distribution'
* TODO Document that the "distribution" method is unsupported
* TODO Move XX_ALLOCC and friends to "memory" module
* TODO Ensure each header file is not dependent on the fact that some other
header file is included before it. (Could this be done by taking each
header file and try to compile it in isolation? It should include
whatever other things it needs...)

* TODO Ensure every file only includes what it needs so that dependencies
are a small as possible. This is why IWYU exists!! It means "Include
What You Use" and is a Clang related project at
https://github.com/include-what-you-use/include-what-you-use)

* TODO Rather than "fprintf(dumpOut...". Adjust options so that we can better
control logging for various modules(?)

** DONE Include and start using log()

** TODO Move output from log() from dumpOut to some logFile
* TODO Ensure all ANSI-C, C99 and C11 keywords (and macros for them?) are
  recognized (list e.g. at
  http://www.c-programming-simple-steps.com/c-keywords.html)

* TODO Memory allocation is home grown, probably out of necessity. Refactor
  to a state where it can be replaced (at least as an experiment) by
  the memory allocation of current run-times. I can't see that even
  32-bit memory restrictions (2 GB) should be a problem. The caching
  might be tied into this, though.

* TODO Naming. Generally it is heavy on short, write-only naming, we should
move towards full names as much as possible

** TODO Remove S_, s_ and other naming conventions
** TODO Use actual typedef names where ever possible
* TODO Macros. There are many things that might need the magic of macros, but we
should watch out for "macro for optimisation" and remove that.

* TODO Header files. There are a number of sections in the proto.h that
  indicates which file/module it declares an externa interface for. We
  should move that to a <module>.h file instead. Just watchout for
  datatypes that need to be in proto.h because of the strFill et. al
  generation. Not all does, though...

* TODO Modules. Better use of modules (Clean Code/Architecture)
The hash tables and lists are such candidates. If we do that it would be much
easier to mock and unit test other modules.
** TODO Extract PPC-functions from misc.c into a ppc-module
** DONE Extract charbuf module
* TODO Change structure declarations in proto.h into ideomatic struct
  {struct} typedefs instead of using typenames generated into the
  strTdef file. See NOTES.md. Few examples of strategy is implemented
  with cctNode and position. Primary benefit is to be able to use
  renaming on them...

* TODO Make Makefile.common look for our patched yacc and if it's not
  available ignore yacc-rules otherwise always run yacc.

* TODO enumTxt.c is a generated set of strings for the enum values in
  proto.h, but the extern declarations of them are in strTdef.g. A
  cleaner way would be to generate them into an "enumTxt.h" (or a
  better name, such as 'generated_enum_strings.h').
  ACTUALLY: split generation of enumTxt header to its own header file
  with the naming strategy as for the others.
* DOING Start using log.c functions to log to a separate log file
* DONE make memory.c (linkage) independent on all other modules
One way to do this to inject the remaining, problematic, dependencies
such as internalCheckFail(), removeFromTrailUntil() and fatalError()
* DONE Move all function prototypes from proto.h to <module>.h
* DONE Create test case for converting virtual function to static
* DONE Fix tests/olcx_refactor_rename gets "buf is not valid"
* DONE Rename all bb -> ast
* DONE Rename maTab to macroArgTab
* DONE Make fillSymbol() and newSymbol() set default symbolBits
then we only need to set non-default values (which could be done
using setType(), setStorage() and so on, functions
* DONE Remove FILLF_fileItem() by replacing it with fillFileItem()
** DONE Make hashTabAdd() return int rather than *int out arg
*** DONE Make IsMember() return position rather than out argument
**** DONE Replace fileTabIsMember() with fileTabExists()/fileTabLookup()
**** DONE Implement fileTabLookup()
*** DONE Make addFileTabItem return the position rather than out arg
**** DONE Cover jarFileParse() with test
* DONE Create a map of how structs are dependent on each other
* DONE Add an -exit option so that clients can take down server cleanly
* DONE Ensure only externally used functions are visible in the modules
header file. And that only those are "non-static" in the C file.
* DONE Make edit_server_driver read output from pipespy
Idea is to be able to record interactions and then re-play them
with the driver.
* DONE Build a protocol spy that can be put between the editor and the
server to inspect and learn about the communication. It should be
fairly easy, just start up like c-xref does, start the real c-xref
with the startup arguments. Shuffle all communication on to the other
while logging the messages to a file.

* DONE Although generation of typedef's etc. in strTdef et al might be
  questioned we need to handle that for now, but at least let's add
  #ifndef guards so that any file that requires a typedef can include
  them without need to consider the order of the included
  files. (Until we get into a dependency loop...)

* DONE Change naming strategy for the bootstrap and generated
  files. "*.bs.h" is now a bootstrap file, while *.g.h" is the local
  generated one using the boostrap version of c-xref. Also a single
  header file for each of the generated files is now taking care of
  the BOOTSTRAPPING ifdef and include the correct bootstrap or
  generated file.

* DONE Unit tests. There are now some simple ones. We need to get some working as
  quickly as possible. Meanwhile there are some functional level tests
  in ../tests, but as all integrating tests with I/O they are quite
  slow. (And some only work on huge data, because that was the test
  case given for some issues, and I really want to have a test case
  for each issue before fixing it, if possible.)

* DONE Make yacc parsing allowed the default. Change Makefile.common so
  that YACCALLOWED is reversed, i.e. if you *don't* want yacc parsing
  in the build c-xref set EXCLUDE_YACC_PARSING (or something similar)
  ACTUALLY: removed conditionals around that code, and kept the CCC
  conditionals.

* DONE Refactor out the hashtables and lists to separate modules.
* DONE Fix byacc skeleton to "goto <non-used label>" by remove ifdef around "lint"

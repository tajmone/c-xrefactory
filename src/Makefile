#########################################################################
#
# Top-level Makefile for c-xref
#
# The important stuff is in Makefile.common
#
# I am unsure if the other Makefile.<platform> are really necessary, or
# if their particular settings are important.
#
# I'll be slowly cleaning up this ancient code and we'll see what's left.
#
# Basic principle:
#   - parsing is done for C, Java, Yacc and C-expressions
#   - parser is generated from .y-files using a patched version of byacc-1.9
#   - do 'make yacc' to regenerate parsers
#   - 'make' should build from current sources so that 'git clone; make' works
#   - as the real c-xref is built with the pre-defined types and stuff for the
#     current machine, those need to be generated by a bootstrap version which
#     must be possible to build on any platform using the checked in sources.

CC= gcc -g -Wall
COMCFLAGS= $(INCLUDES) -DDEBUG $(ZLIB_OPT) \
			-DPRESERVE_C_ARGS -DGNULINUXDEFS -DYACC_ALLOWED
CFLAGS= -c -g -Og $(COMCFLAGS)
EDGCFLAGS= -O
LDFLAGS=
BIN=$(HOME)/bin
LEX=flex

# We need our own patched yacc
YACC=$(ROOTDIR)/byacc-1.9/yacc

ROOTDIR=..

#########################################################################


include Makefile.common
include Makefile.dependencies


#########################################################################
#
# Trigger running YACC on possibly updated grammar files

yacc: $(YACC)
	$(MAKE) YACCING=yes

$(YACC):
	$(MAKE) -C $(ROOTDIR)/byacc-1.9
